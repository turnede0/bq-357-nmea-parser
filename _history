{"entries":[{"timestamp":1768893704073,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":182,"diffs":[[1,"<xml xmlns=\"http://www.w3.org/1999/xhtml\">\n  <block type=\"pxt-on-start\"></block>\n  <block type=\"device_forever\"></block>\n</xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":33,"diffs":[[1,"\n"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":241,"length1":35,"diffs":[[1,"    \"additionalFilePaths\": []\n"]]}]}]},{"timestamp":1768893712985,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"pxt.json","patch":[{"start1":241,"length1":31,"diffs":[[1,"    \"preferredEditor\": \"blocksprj\"\n"]]}]}]},{"timestamp":1768894603874,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.ts","patch":[{"start1":33,"length1":7018,"diffs":[[1,""]]}]}]},{"timestamp":1768894605353,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":84,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"></block><block type=\"device_forever\" x=\"205\" y=\"0\"></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":0,"diffs":[[1,"basic.forever(function () {\n\t\n})\n// In main.ts\n\n"]]},{"start1":66,"length1":121,"diffs":[[1,"    // Recommended: use Serial pins P1 (RX), P2 (TX) - but only RX is needed\n    const GPS_RX_PIN = SerialPin.P1;   // change if using different pin\n"]]},{"start1":216,"length1":290,"diffs":[[1,"    // State variables\n    let isOutdoor = false;             // true = 3D fix (usable position)\n    let utcTime = \"\";                  // \"hhmmss.sss\" or \"\"\n    let latitude = \"\";                 // \"ddmm.mmmm\" raw or \"\"\n    let longitude = \"\";                // \"dddmm.mmmm\" raw or \"\"\n    let speedKnots = 0;                // 0..999\n    let satellites: SatInfo[] = [];    // latest list from GSV\n\n    interface SatInfo {\n        id: number;        // satellite PRN / number\n        type: string;      // \"GPS\" or \"BeiDou\"\n        elevation: number; // 0..90 °\n        azimuth: number;   // 0..359 °\n        snr: number;       // 0..99 dB-Hz\n"]]},{"start1":867,"length1":169,"diffs":[[1,"    // -------------------------------------------------------------------------\n    // Public blocks\n    // -------------------------------------------------------------------------\n"]]},{"start1":1051,"length1":150,"diffs":[[1,"    /**\n     * Start listening to GNSS module on the given serial pin\n     * @param rxPin RX pin connected to module TX\n     */\n    //% block=\"start GNSS on RX %rxPin\"\n    //% rxPin.fieldEditor=\"gridpicker\"\n    //% rxPin.fieldOptions.width=220\n    //% rxPin.fieldOptions.columns=4\n    export function start(rxPin: SerialPin = GPS_RX_PIN): void {\n        serial.redirect(\n            SerialPin.USB_TX,   // dummy TX (not used)\n            rxPin,\n            BaudRate.BaudRate9600\n        );\n\n        // Important: enable receiver buffer and line ending detection\n        serial.setRxBufferSize(128);\n        control.inBackground(readAndParseLoop);\n"]]},{"start1":1705,"length1":153,"diffs":[[1,"    /**\n     * Returns true when a 3D fix is available (outdoor/usable position)\n     */\n    //% block=\"GNSS is outdoor (3D fix)\"\n    export function isOutdoorFix(): boolean {\n        return isOutdoor;\n"]]},{"start1":1914,"length1":298,"diffs":[[1,"    /**\n     * UTC time from last valid fix (empty string if no fix)\n     */\n    //% block=\"GNSS UTC time\"\n    export function getUtcTime(): string {\n        return utcTime || \"undef\";\n"]]},{"start1":2106,"length1":299,"diffs":[[1,"    /**\n     * Latitude in ddmm.mmmm format (empty if no fix)\n     */\n    //% block=\"GNSS latitude\"\n    export function getLatitude(): string {\n        return latitude || \"undef\";\n"]]},{"start1":2293,"length1":168,"diffs":[[1,"    /**\n     * Longitude in dddmm.mmmm format (empty if no fix)\n     */\n    //% block=\"GNSS longitude\"\n    export function getLongitude(): string {\n        return longitude || \"undef\";\n"]]},{"start1":2485,"length1":139,"diffs":[[1,"    /**\n     * Speed over ground in knots (0 if no fix)\n     */\n    //% block=\"GNSS speed (knots)\"\n    export function getSpeedKnots(): number {\n        return isOutdoor ? speedKnots : 0;\n"]]},{"start1":2680,"length1":359,"diffs":[[1,"    /**\n     * Number of satellites in latest GSV sentences\n     */\n    //% block=\"GNSS number of satellites\"\n    export function satelliteCount(): number {\n        return satellites.length;\n    }\n"]]},{"start1":2878,"length1":138,"diffs":[[1,"    /**\n     * Get satellite info at index (0-based)\n     * @param index satellite index\n     */\n    //% block=\"satellite at %index info\"\n    export function getSatelliteInfo(index: number): string {\n        if (index < 0 || index >= satellites.length) return \"\";\n        let s = satellites[index];\n        return `${s.type} ${s.id} el:${s.elevation}° az:${s.azimuth}° snr:${s.snr}`;\n    }\n"]]},{"start1":3269,"length1":41,"diffs":[[1,"    // -------------------------------------------------------------------------\n    // Background parser loop\n    // -------------------------------------------------------------------------\n"]]},{"start1":3462,"length1":621,"diffs":[[1,"    function readAndParseLoop(): void {\n        while (true) {\n            let line = serial.readUntil(\"\\n\");\n            if (line.length < 8) continue;\n"]]},{"start1":3616,"length1":147,"diffs":[[1,"            // Remove \\r if present\n            if (line.charAt(line.length - 1) === \"\\r\") {\n                line = line.substr(0, line.length - 1);\n"]]},{"start1":3780,"length1":196,"diffs":[[1,"            parseNMEALine(line);\n        }\n"]]},{"start1":3830,"length1":192,"diffs":[[1,"    function parseNMEALine(line: string): void {\n        if (!line.startsWith(\"$\")) return;\n"]]},{"start1":3923,"length1":110,"diffs":[[1,"        // Very basic checksum verification (optional but recommended)\n        let starPos = line.lastIndexOf(\"*\");\n        if (starPos < 0 || starPos + 2 !== line.length) return;\n"]]},{"start1":4104,"length1":239,"diffs":[[1,"        let expectedCS = line.substr(starPos + 1);\n        let calcCS = computeChecksum(line.substr(1, starPos - 1));\n        if (calcCS.toUpperCase() !== expectedCS.toUpperCase()) return;\n"]]},{"start1":4294,"length1":103,"diffs":[[1,"        let parts = line.split(\",\");\n        if (parts.length < 6) return;\n\n        let talker = parts[0].substr(1, 2);   // GN / GP / BD / GB\n        let sentence = parts[0].substr(3);    // GGA / RMC / GSV / GSA ...\n\n        if (sentence === \"GGA\") {\n            parseGGA(parts);\n        } else if (sentence === \"RMC\") {\n            parseRMC(parts);\n        } else if (sentence === \"GSV\") {\n            parseGSV(parts, talker);\n        }\n        // GSA can be parsed too if you want PDOP/HDOP/VDOP later\n    }\n\n    // Very simple NMEA checksum\n    function computeChecksum(s: string): string {\n        let cs = 0;\n        for (let i = 0; i < s.length; i++) {\n            cs ^= s.charCodeAt(i);\n        }\n        return cs.toString(16).toUpperCase().padStart(2, \"0\");\n    }\n\n    function parseGGA(parts: string[]): void {\n        // $GNGGA,hhmmss.sss,lat,N,lon,E,fix,numsats,hdop,alt,M,geoid,M,...\n        if (parts.length < 10) return;\n\n        let fix = parseInt(parts[6] || \"0\");\n        isOutdoor = (fix === 1 || fix === 2 || fix === 3);\n\n        if (isOutdoor) {\n            utcTime = parts[1] || \"\";\n            latitude = parts[2] || \"\";\n            longitude = parts[4] || \"\";\n        } else {\n            utcTime = \"\";\n            latitude = \"\";\n            longitude = \"\";\n        }\n    }\n\n    function parseRMC(parts: string[]): void {\n        // $GNRMC,hhmmss.sss,A,lat,N,lon,E,speedKnots,course,ddmmyy,...\n        if (parts.length < 10) return;\n\n        let status = parts[2] || \"V\";\n        isOutdoor = (status === \"A\");\n\n        if (isOutdoor) {\n            utcTime = parts[1] || \"\";\n            latitude = parts[3] || \"\";\n            longitude = parts[5] || \"\";\n            speedKnots = parseFloat(parts[7]) || 0;\n        } else {\n            speedKnots = 0;\n        }\n    }\n\n    function parseGSV(parts: string[], talker: string): void {\n        // $GPGSV / $BDGSV, numMsg, msgNum, totalSats, then repeating: id,elev,az,snr, ...\n        if (parts.length < 4) return;\n\n        let sys = (talker === \"GP\" || talker === \"GN\") ? \"GPS\" : \"BeiDou\";\n\n        // We collect all satellites from all GSV sentences → clear only at beginning of new cycle\n        // Simplest (but not perfect): clear when we see msgNum == 1\n        if (parseInt(parts[2]) === 1) {\n            satellites = [];\n        }\n\n        let i = 4; // first satellite field\n        while (i + 3 < parts.length) {\n            let id = parseInt(parts[i]) || 0;\n            let elev = parseInt(parts[i + 1]) || 0;\n            let az = parseInt(parts[i + 2]) || 0;\n            let snr = parseInt(parts[i + 3]) || 0;\n\n            if (id > 0) {\n                satellites.push({ id, type: sys, elevation: elev, azimuth: az, snr });\n"]]},{"start1":7014,"length1":21,"diffs":[[1,"            i += 4;\n"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":241,"length1":44,"diffs":[[1,""]]}]},{"type":"added","filename":"test.ts","value":"// 在這裡測試；當此封包作為擴充功能時，將不會編譯此內容。\n"}]}],"snapshots":[{"timestamp":1768893704072,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"http://www.w3.org/1999/xhtml\">\n  <block type=\"pxt-on-start\"></block>\n  <block type=\"device_forever\"></block>\n</xml>","main.ts":"\n","README.md":"","pxt.json":"{\n    \"name\": \"BQ-357-NMEA-parser\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"radio\": \"*\",\n        \"microphone\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\"\n    ],\n    \"additionalFilePaths\": []\n}\n"}}],"shares":[],"lastSaveTime":1768895074769}